import{f as e,p as t,m as o,o as i,c as s,t as n,a as r,n as a}from"./vendor.b7e9e33c.js";import{d as l,v as c}from"./index.4b5aafaa.js";const d={name:"Settings",data:()=>({token:"",isTokenRegistered:!1,errorMsg:!1}),methods:{async checkToken(){let e=await l.collection("notification_tokens").doc(this.token).get();this.isTokenRegistered=e.exists},enableNotifications(){l.collection("notification_tokens").doc(this.token).set({userId:this.$store.getters.user.uid,addedAt:new Date,username:this.$store.getters.user.name,userAgent:navigator.userAgent}).then((e=>this.isTokenRegistered=!0)).catch((e=>console.log(e))),console.log("enabling button pressed")},disableNotifications(){l.collection("notification_tokens").doc(this.token).delete().then((e=>this.isTokenRegistered=!1))},initFCM(){if(e.messaging.isSupported()){e.messaging().getToken(c).then((e=>{e&&(this.token=e,this.checkToken())})).catch((e=>{console.log("An error occurred while retrieving token. ",e)}))}else this.errorMsg="Notification not supported by your device"},requestPermissionCallback(e){console.log(e),"granted"===e?(this.errorMsg=!1,this.initFCM()):"denied"===e&&(this.errorMsg="You Just blocked notifications!  Try to allow them in browser setting")}},created(){if("granted"===Notification.permission)console.log("granted"),this.initFCM();else if("default"===Notification.permission)console.log("default"),this.errorMsg="Allow notifications please",Notification.requestPermission(this.requestPermissionCallback);else if("denied"===Notification.permission)return console.log("denied"),this.errorMsg="You blocked notifications!  Try to allow them in browser setting"}},g=a();t("data-v-77eb1c52");const f={class:"flex flex-col justify-center w-2/6 c-sm-w-full mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"},b=r("div",{class:"text-2xl px-10 py-10 text-center"},"Notifications",-1),h={key:1},u={key:0,class:"flex flex-col"},k=r("p",{class:"text-center p-3 bg-green-300 my-3"},"Notifications are enabled on this device",-1),m={key:1,class:"flex flex-col"},p=r("p",{class:"text-center p-3 bg-red-400 my-3"},"Notifications are disabled on this device",-1);o();const x=g(((e,t,o,a,l,c)=>(i(),s("div",f,[b,e.errorMsg?(i(),s("div",{key:0,textContent:n(e.errorMsg),class:"text-center p-3 bg-red-300"},null,8,["textContent"])):(i(),s("div",h,[e.isTokenRegistered?(i(),s("div",u,[k,r("button",{onClick:t[1]||(t[1]=(...e)=>c.disableNotifications&&c.disableNotifications(...e)),class:"bg-red-400 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full my-3"}," Disable Notifications ")])):(i(),s("div",m,[p,r("button",{onClick:t[2]||(t[2]=(...e)=>c.enableNotifications&&c.enableNotifications(...e)),class:"bg-green-300 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-full my-3"}," Enable Notifications ")]))]))]))));d.render=x,d.__scopeId="data-v-77eb1c52";export default d;
