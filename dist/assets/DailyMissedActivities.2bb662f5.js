import{d as t}from"./index.988dbf47.js";import{k as e,o as a,c as i,a as d,F as s}from"./vendor.57260a3e.js";const o={name:"Users",data:()=>({activities:[]}),methods:{log(t){let e=document.createElement("H3");e.append(t),e.classList.add("my-3"),this.$refs.logs.appendChild(e),console.log(t)}},async mounted(){let a=await t.collection("users").get();for(const i of a.docs){this.log(`checking for user (${i.data().name})`);let a=await t.collection("user_activity").where("userId","==",i.id).get();for(const d of a.docs){let a=await t.collection("activities").doc(d.data().activityId).get();if("daily"===a.data().type){let d=e(i.data().lastCheck.toDate()).startOf("day"),s=e().startOf("day");for(this.log(`checking for Activity (${a.data().title})`);d.diff(s,"day");){this.log(`checking for Day (${d.format("YYYY-MM-DD")})`);let s=await t.collection("completed_activities").where("userId","==",i.id).where("activityId","==",a.id).where("dateTime",">=",new Date(d.startOf("day").format())).where("dateTime","<=",new Date(d.endOf("day").format())).get(),o=await t.collection("missed_activities").where("userId","==",i.id).where("activityId","==",a.id).where("missedDay","==",d.format("YYYY-MM-DD")).get();if(0===s.docs.length&&0===o.docs.length){let s=await t.collection("missed_activities").add({activityId:a.id,userId:i.id,dateTime:new Date,missedDay:d.format("YYYY-MM-DD")});await t.collection("transactions").add({amount:a.data().mulct,type:"mulct",userId:i.id,createdAt:new Date,missedActivityId:s.id,activityId:a.id}),this.log(`"${i.data().name}" mulct for "${a.data().title}" for "${d.format("YYYY-MM-DD")}" by "${a.data().mulct}"ID at "${e().format("DD-MM-YYYY hh:mm:ss")}" run By "${this.$store.getters.user.email}"`)}else this.log("passed or already paid");await t.collection("users").doc(i.id).update({lastCheck:new Date}),d=d.add(1,"day")}}}}}},r=d("div",{class:"flex justify-center w-2/6 mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"},[d("div",{class:"text-2xl px-10 py-10"},"Check for missed Activities")],-1),l={ref:"logs",class:"flex flex-col px-5 py-5 w-1/2 lg:w-2/3 sm:w-5/6 mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"};o.render=function(t,e,o,c,n,m){return a(),i(s,null,[r,d("div",l,null,512)],64)};export default o;
