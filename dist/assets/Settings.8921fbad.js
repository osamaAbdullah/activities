import{f as e,o as t,c as i,t as o,a as s}from"./vendor.b7e9e33c.js";import{d as n,v as r}from"./index.5a09a179.js";const a={name:"Settings",data:()=>({token:"",isTokenRegistered:!1,errorMsg:!1}),methods:{async checkToken(){let e=await n.collection("notification_tokens").doc(this.token).get();this.isTokenRegistered=e.exists},enableNotifications(){n.collection("notification_tokens").doc(this.token).set({userId:this.$store.getters.user.uid,addedAt:new Date,username:this.$store.getters.user.name,userAgent:navigator.userAgent}).then((e=>this.isTokenRegistered=!0))},disableNotifications(){n.collection("notification_tokens").doc(this.token).delete().then((e=>this.isTokenRegistered=!1))},initFCM(){if(e.messaging.isSupported()){e.messaging().getToken(r).then((e=>{e&&(this.token=e,this.checkToken())})).catch((e=>{console.log("An error occurred while retrieving token. ",e)}))}else this.errorMsg="Notification not supported by your device"},requestPermissionCallback(e){console.log(e),"granted"===e?(this.errorMsg=!1,this.initFCM()):"denied"===e&&(this.errorMsg="You Just blocked notifications!  Try to allow them in browser setting")}},created(){if("granted"===Notification.permission)this.initFCM();else if("default"===Notification.permission)this.errorMsg="Allow notifications please",Notification.requestPermission(this.requestPermissionCallback);else if("denied"===Notification.permission)return this.errorMsg="You blocked notifications!  Try to allow them in browser setting"}},c={class:"flex flex-col justify-center w-2/6 mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"},l=s("div",{class:"text-2xl px-10 py-10 text-center"},"Notifications",-1),d={key:1},f={key:0,class:"flex flex-col"},g=s("p",{class:"text-center p-3 bg-green-300 my-3"},"Notifications are enabled on this device",-1),h={key:1,class:"flex flex-col"},b=s("p",{class:"text-center p-3 bg-red-400 my-3"},"Notifications are disabled on this device",-1);a.render=function(e,n,r,a,u,k){return t(),i("div",c,[l,e.errorMsg?(t(),i("div",{key:0,textContent:o(e.errorMsg),class:"text-center p-3 bg-red-300"},null,8,["textContent"])):(t(),i("div",d,[e.isTokenRegistered?(t(),i("div",f,[g,s("button",{onClick:n[1]||(n[1]=(...e)=>k.disableNotifications&&k.disableNotifications(...e)),class:"bg-red-400 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full my-3"}," Disable Notifications ")])):(t(),i("div",h,[b,s("button",{onClick:n[2]||(n[2]=(...e)=>k.enableNotifications&&k.enableNotifications(...e)),class:"bg-green-300 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-full my-3"}," Enable Notifications ")]))]))])};export default a;
