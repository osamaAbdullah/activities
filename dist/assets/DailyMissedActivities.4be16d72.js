import{d as t,s as a}from"./index.e2719b7e.js";import{k as e,o as i,c as s,a as d,F as o}from"./vendor.b7e9e33c.js";async function c(i,s){s(`checking for user (${i.data().name})`);let d=await t.collection("user_activity").where("userId","==",i.id).get();for(const o of d.docs){let d=await t.collection("activities").doc(o.data().activityId).get();if("daily"===d.data().type&&d.data().status){let c=e(o.data().lastCheck.toDate()).startOf("day"),r=e().startOf("day");for(s(`checking for Activity (${d.data().title})`);c.diff(r,"day");){s(`checking for Day (${c.format("YYYY-MM-DD")})`);let o=`${d.id}__${i.id}__${c.format("YYYY_MM_DD")}`,r=await t.doc(`completed_activities/${o}`).get(),l=await t.doc(`missed_activities/${o}`).get();r.exists?s("Passed"):l.exists?s("Already paid"):(await t.collection("missed_activities").doc(o).set({activityId:d.id,userId:i.id,dateTime:new Date,missedDay:c.format("YYYY-MM-DD")}),await t.collection("transactions").doc("mulct_"+o).set({amount:d.data().mulct,type:"mulct",userId:i.id,createdAt:new Date,missedActivityId:o,activityId:d.id}),await t.collection("transactionLog").add({user:i.data().name,activity:d.data().title,date:c.format("YYYY-MM-DD"),mulct:d.data().mulct,createdAt:e().format("DD-MM-YYYY hh:mm:ss"),by:a.getters.user.email}),s(`"${i.data().name}" mulct for "${d.data().title}" for "${c.format("YYYY-MM-DD")}" by "${d.data().mulct}"ID at "${e().format("DD-MM-YYYY hh:mm:ss")}" run By "${a.getters.user.email}"`)),await t.collection("user_activity").doc(i.id+"_"+d.id).update({lastCheck:new Date}),c=c.add(1,"day")}}}}const r={name:"Users",data:()=>({activities:[]}),methods:{log(t){let a=document.createElement("H3");a.append(t),a.classList.add("my-3"),this.$refs.logs.appendChild(a),console.log(t)},async checkAllUsers(){for(const a of await async function(){return(await t.collection("users").get()).docs}())await c(a,this.log)}},mounted(){this.checkAllUsers()}},l=d("div",{class:"flex justify-center w-2/6 mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"},[d("div",{class:"text-2xl px-10 py-10"},"Check for missed Activities")],-1),n={ref:"logs",class:"flex flex-col px-5 py-5 w-1/2 lg:w-2/3 sm:w-5/6 mx-auto shadow overflow-hidden border-b border-gray-200 sm:rounded-lg my-6"};r.render=function(t,a,e,c,r,m){return i(),s(o,null,[l,d("div",n,null,512)],64)};export default r;
